# rb-stack - Standardized Kubernetes Deployment Chart
# Simplifies deployment with: name = namespace = labels = serviceaccount

# Application name - defines namespace, serviceaccount, labels, and secret names
name: ""

# Environment (prod, stg, dev) - used for Vault paths
environment: prod

# Global values passed to all subcharts
global:
  name: ""
  environment: prod
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
  imagePullSecrets: []

# Vault configuration for External Secrets Operator
vault:
  # Base path in Vault (without environment)
  # Secrets will be fetched from: {basePath}/{environment}/{component}
  # Example: k3s/myapp/prod/app, k3s/myapp/prod/db
  basePath: ""

  # Vault server URL
  server: https://vault.rodolfodebonis.com.br

  # Mount path for KV secrets engine
  mountPath: k3s

  # Auth configuration
  auth:
    # Override role name (defaults to {name}-role)
    role: ""

  # Optional: Remap specific keys from Vault to different K8s secret keys
  # Example:
  #   remap:
  #     app:
  #       DB_PASSWORD: DB_SECRET  # Vault.DB_PASSWORD -> K8s.DB_SECRET
  #     db: {}
  remap:
    app: {}
    db: {}
    redis: {}

# Web Server subchart configuration
web-server:
  enabled: false
  # Suffix for deployment/service names: "web" -> app-web, "api" -> app-api, "" -> app
  suffix: web
  replicas: 1
  image:
    repository: ""
    tag: "latest"
    pullPolicy: IfNotPresent
  port: 3000
  expose: false  # If true, adds cloudflare.io/expose annotation
  host: ""       # Required if expose=true

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"

  probes:
    readiness:
      enabled: true
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 5
    liveness:
      enabled: true
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10

  hpa:
    enabled: false
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

  monitoring:
    enabled: false
    path: /metrics
    port: 3000

  ingress:
    className: traefik
    annotations: {}
    tls:
      enabled: true
      issuer: letsencrypt-issuer

# PostgreSQL subchart configuration
postgres:
  enabled: false
  image:
    repository: postgres
    tag: "17.2"
    pullPolicy: IfNotPresent
  port: 5432
  storage: 2Gi
  storageClassName: ""

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Internal network access via pfSense DNS
  internalAccess:
    enabled: false
    hostname: ""  # e.g., myapp-postgres.rb.lab

# Redis subchart configuration
redis:
  enabled: false
  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent
  port: 6379
  storage: 1Gi
  storageClassName: ""
  persistence:
    enabled: false

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"

  # Internal network access via pfSense DNS
  internalAccess:
    enabled: false
    hostname: ""  # e.g., myapp-redis.rb.lab

# MongoDB subchart configuration
mongodb:
  enabled: false
  image:
    repository: mongo
    tag: "7.0"
    pullPolicy: IfNotPresent
  port: 27017
  storage: 5Gi
  storageClassName: ""

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Internal network access via pfSense DNS
  internalAccess:
    enabled: false
    hostname: ""  # e.g., myapp-mongo.rb.lab

# Security context defaults
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false

# Image pull secrets (if using private registry)
imagePullSecrets: []
